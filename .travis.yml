language: node_js
node_js:
  - '12'
dist: trusty
services:
  - mongodb
env:
  matrix:
    - NODE_ENV=ci PORT=3000
cache:
  directories:
    - node_modules
    - client/mode_modules
    - server/node_modules
install:
  - npm run prodinstall
script:
  - cd client
  - yarn
  - yarn build
  - cd ../server
  - mkdir uploads
  - mkdir uploads/audio uploads/images uploads/testFiles
  - nohup npm run ci &
  - sleep 3
  - npm run ci-test
deploy:
  provider: elasticbeanstalk
  access_key_id:
    secure: Fx4AHXvWYE3Nkk5NSCiMFzAS3PEOfZNLKTLGdsynkdo0tJp3tk/+o7wPcB4dNfnzo8ftRREY/2s0ip9rKWtDzufKQzDZteeFrZFnO4CRW43NkOO4hMHRF1ym/1wyIFQUwtNnjb3JJa6AhOJhjzo8VsvWC2lbKwSNOJMSo7Mz/5JJ+5RKgWT4Yfj/xKIM/16n8Ew0jZALiEaOGCKEXsMJggXEmtOm7k5jKxNJRKUy21wgDF9VT9JNBSm7JdYlZPZX/X4MqjxsKa9yMQFsdxye7xH/SF+PAqo8iLWc4CW2C5CW+q0T+azZsXfozhtHbOAwEc15hQevGVY6xCHMB2lLSgFawCM/tGsEXwgaJ5Y1VQ8feJnDFNDL0inB+sEeS5dkm19RVCFpwNrSP36Lr6rat97WjZfI2uWleob33Pd0yujFWgeA/nEw02G3uNVvS+cdKIjwmKncOPXZ2/ec5i/jwvNnFHPdZ9bJEAq/xuM656Lalb2Xw+OYbFu7bOuL0nPcX26HCXT+ZmVlQwiJFw1zVuMDAdAyBjbKhGCxnI46bSHi/KoHw8d9Og/K8vSn/TeEoFw+vW23GGOvRy7QG6WFRWo26j6XgQIhQJTB5lt0F1ZDxC8h5T2ct3f3/AXLJjGIbtNohBm1ISsNlV1tcMPf7Qdb94ASjU7j4nFy/OQBR5Q=
  secret_access_key:
    secure: bnHVszmFgq1SJuWRS2uhzORxZ3ox/HJD/jHSQ5sEmeKUc4jhDDiBRhLQr63RutrHQOC+0gCT0Uqu4OIFwpoM/DuHgn4Ju0eLUjppV0QRo4kx8U9gQ1iNzxX+O7txm9F07w0Kb2iCwSS+uS4Rm+yBzYcBp20dMtWZK1G7eP8YCcGlcoYYc5hQuAHgKQ4u7qY9hpfYzG87Wkqlw0qZz/ABuoamzZ0Cxypx7rU2rap6dHW8smheaj9oCAlGdUMpWMolGPgQdgA6FO1ORdnepd8MCXwme93dgJQuGFVZrTHbWUVYrB6KuKKAnJ5pcYKSxDDowTFB9PMg7SCf/ubPb+7AQSniHIac6/GKoZY8qxZjwhJtpX2XKM+pNCiDrZSla4ZS1mNqjOsab4Q6QsCLtrb7tNsXQIC2Ta/0KCHF4i1D3jTDUip8+oP+E92dxBN3vS9oCLK5+zDWlQJM8C9evCWHkZomZXm0YTNkT/GSGI/DS1j2Oovv6yawUPkS6t53vwntUeHZemEUifHHtJEvWyn8tD+Syy2lK61dN+Eu6K4S7xZgWU6NRDTJs1SSsYk9wjAGGuQI9WN+/Aw/PpR4abpG4d10SgA3KhRnrZd6njSeQilxLPlqZVXyc1m2Ge8K+tVgATuaDmacdZQpOPdeL7lDG2xvblUVB5BeaitM9c1Q4KA=
  region: us-west-2
  app: jukebox
  env: e-zadxf37hpy
  on:
    repo: phonofidelic/JukeBox
