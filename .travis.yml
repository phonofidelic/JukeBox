language: node_js
node_js:
  - '12'
dist: trusty
services:
  - mongodb
env:
  matrix:
    - NODE_ENV=ci PORT=3000
cache:
  directories:
    - node_modules
    - client/mode_modules
    - server/node_modules
install:
  - npm run prodinstall
script:
  - cd client
  - yarn
  - yarn build
  - cd ../server
  - mkdir uploads
  - mkdir uploads/audio uploads/images uploads/testFiles
  - nohup npm run ci &
  - sleep 3
  - npm run ci-test
deploy:
  provider: elasticbeanstalk
  access_key_id:
    secure: KiJdOhk3fCV55YmkmOH79AMirf2QVcRrbAG4lSDPB3LthqFi3I7av2YXK8yezvUKcL8dKJjaXBlxmuA8bK54SW7DtIQALR/8P063rYYZCARgmnzTjmSRz/fkt2yiWEMqNYLq5eqvCfnF2QBknwx/kPPDRfdkugT3zz7C4Xj+aIAEYFAmjKUIhmKx8xWUXe5SOfeD00lO2wX+lrkOgKetsvIIdUZqIvG1HwmO83qRM4ypQde2QkzYf8YXGfKA8VKI0UEXKz4tPcZAspB7LMBoa9T9/c16g2Rpz+hJuB2AGzQlb6zjkPevQutY/esDofb8H9ir2AGrdFEOwfO8ztu8Zfy8Egy44muwP+NgmwlX7iGLTfTJ514Ffu4TbvORnbvNXsbQdXcDP6x0DUXBpqLytUeYNP02Hl7Nr9Igx8Xes/4W9nlDpAM62/qMPag7699wuzIR4JvmjWcSp0c+CXZ+IrtV7Bqy6kXzHlvKUFJkBu+1FmJcYgTlkiwceWK2KBZZBmdeftpeupgjyxpXxXBYeo1/U7PHpFL8xpcrREwO8KFrS3LxBVr41+oWGF1Dct9E7HfgOXZCXAM78CFInIJ5gnL8BhLzOHUcdGqT4Bh3hQxwRm0butVnBWmC4VJLC+6HnHO0YgqSTAo0GS/s4v7jXEOsbq/UoAES60rBcvs9qfE=
  secret_access_key:
    secure: LGh+ZY5PM20ybUjDS9zy/mbfZKdl7SZfAK4IE13yitnouPXfug4dBPYMAybzOL15HIHuPAyoSheYWMn8LmlgtHUkljwnOtYMGU6xQFsYkS2pUh4lX+ruu79J8uj/oOLRYdd6Q3YGNnJ1JHXyPjCCswCa2HLMjoikJNnltTWKxmM9sBteL0SKsUL/pt+Z0t0u0r0JTuUKnvsvPAmK6PeYcm4I/GVQcntihEixS7cRUV5MSLUqnuQvKWy8wT1bLfxJSKVX8zPSMFH6poZOTJ02s6wFeii1fBzEKk9B/JXRD/CKmfDY2+Owuc9qj+JdgWEqVTEBDc6yhyMiocbEE3c80ba0RDiFBri8fWwEf8f1/IYft5NTTZsXXWqF1iANFwfYcwErxPJeBL8BnCyd4JAOyrdBB/PJXoqkXTiXQjnDTNU18DFjBsKmMkOV2E/fLXAyGkpEV8u1Q2bFrzoRws1jYIIXdO77p7G/TRORjHUQj9wGaapjje2SM1EHnIpKZbNv5RjylcT86GT1iu7wDQQ0KwzuHjf8aClhTfEB2McAA89lB92L2GJKfvZcJiS+0MjlfCmUaS9z12/tHWfa6e5RnKnfOgHtpnhIDZAm95JdrEOLU3QaUdHoqg2zzJhknq2Bo4sNQ6CUq/bbyb6+KBRcKFmW6q/A4nfwhFPOe7O6Rio=
  region: us-west-2
  app: jukebox
  env: e-zadxf37hpy
  bucket_name: elasticbeanstalk-us-west-2-016190279810
  on:
    repo: phonofidelic/JukeBox
